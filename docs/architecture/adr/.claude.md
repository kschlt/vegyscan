# ADR (Architecture Decision Records) - AI Instructions

## CRITICAL: ADR Immutability Principle

**Once an ADR status is "Accepted", it becomes IMMUTABLE.**

This preserves the historical decision trail and prevents loss of context.

---

## Creating New ADRs

### When to create
- Significant technology choice (framework, database, library)
- Architecture pattern decision (microservices, monolith, etc.)
- Major refactoring approach
- Infrastructure/deployment strategy
- Security/privacy architecture
- Any decision with long-term consequences

### When NOT to create
- ❌ Minor library choices (use git commit message)
- ❌ Coding style preferences (use linting config)
- ❌ Temporary workarounds
- ❌ Business decisions (→ business domain)

### Process
1. Copy `0000-template.md` to new file
2. Name it: `NNNN-short-description.md` (NNNN = next sequential number)
3. Fill all sections: Context, Decision, Consequences
4. Set Status to "Proposed"
5. Link to requirements that drive this decision
6. After stakeholder approval, change Status to "Accepted"
7. Update `../overview.md` if tech stack changes
8. Update `../../decisions/decision-log.md`

### Numbering Rules
- ✅ Sequential: 0001, 0002, ..., 0010, ..., 0123
- ✅ Zero-padded to 4 digits
- ✅ Never reuse numbers, even for deprecated ADRs
- ❌ Don't skip numbers
- ❌ Don't use dates or other schemes

### Naming Rules
- ✅ `0001-choose-react-native.md`
- ✅ `0012-adopt-postgresql.md`
- ✅ `0099-implement-offline-sync.md`
- ❌ `adr-1.md` (missing zero-padding and description)
- ❌ `choose-react.md` (missing number)
- ❌ `ADR-001-Choose-React.md` (wrong case)

---

## ADR Immutability Rules

### When Status = "Proposed"
- ✅ Can edit ALL sections freely
- ✅ Can change decision
- ✅ Can add/remove consequences
- ✅ Can change status to "Accepted"

### When Status = "Accepted" / "Deprecated" / "Superseded"
- ❌ **NEVER** edit Context section
- ❌ **NEVER** edit Decision section
- ❌ **NEVER** edit Consequences section
- ✅ CAN change Status field
- ✅ CAN add "Update Log" section at bottom
- ✅ MUST create new ADR if decision changes

---

## Superseding Process

When a decision needs to change:

1. **Create NEW ADR:**
   - Next sequential number
   - Describe new decision
   - In Context: Explain why previous decision is being changed
   - Add: `Supersedes: [ADR-XXXX](./XXXX-old-decision.md)`

2. **Update OLD ADR:**
   - Change Status to "Superseded"
   - Add line: `Superseded by: [ADR-YYYY](./YYYY-new-decision.md)`
   - **DO NOT** change anything else

3. **Update References:**
   - `../overview.md` if tech stack changed
   - `../../decisions/decision-log.md`

### Example

**OLD: 0005-use-mongodb.md**
```markdown
## Status

Superseded by: [ADR-0023](./0023-migrate-to-postgresql.md)

~~Accepted~~ → Superseded on 2025-11-20
```

**NEW: 0023-migrate-to-postgresql.md**
```markdown
## Context

We previously chose MongoDB ([ADR-0005](./0005-use-mongodb.md)) for flexibility.
However, we now need ACID transactions for payment processing...

Supersedes: [ADR-0005](./0005-use-mongodb.md)
```

---

## Status Lifecycle

```
Proposed → Accepted → [Deprecated | Superseded]
```

### Status Values

**Proposed:**
- Decision is being considered
- Still open for changes
- Not yet binding

**Accepted:**
- Stakeholders approved
- Team commits to this decision
- **IMMUTABLE** from this point

**Deprecated:**
- Decision no longer recommended
- But not replaced by specific new decision
- Still may be in use (legacy)

**Superseded:**
- Replaced by specific new ADR
- Always link to superseding ADR
- Historical record preserved

---

## ADR Structure (from template)

Each ADR MUST have:
- **Title**: `# ADR-NNNN: [Decision Title]`
- **Status**: One of: Proposed, Accepted, Deprecated, Superseded
- **Date**: Created date (and superseded date if applicable)
- **Context**: What is the issue/problem we're addressing?
- **Decision**: What have we decided? (clear, unambiguous)
- **Consequences**: What are the positive and negative outcomes?
- **Related**: Links to requirements, other ADRs, use cases

Optional sections:
- **Alternatives Considered**: What else did we evaluate?
- **Update Log**: For post-acceptance notes (does NOT change decision)

---

## Content Rules

### Context Section
**Include:**
- ✅ Problem statement
- ✅ Constraints and requirements
- ✅ Link to driving requirements: `[REQ-NF-005](../../business/requirements/non-functional.md#req-nf-005)`
- ✅ Current situation

**Exclude:**
- ❌ The decision itself (that's next section)
- ❌ Implementation details (too granular)

### Decision Section
**Include:**
- ✅ Clear statement: "We will use React Native for mobile development"
- ✅ Key aspects of the decision
- ✅ Scope: What this covers

**Exclude:**
- ❌ Rationale (that's in Context)
- ❌ Consequences (that's next section)

### Consequences Section
**Include:**
- ✅ Positive outcomes
- ✅ Negative outcomes
- ✅ Trade-offs
- ✅ Impact on team/process/system
- ✅ Future implications

**Be honest about negatives** - this helps future decisions.

---

## Update Log (Post-Acceptance)

If you need to add notes after acceptance WITHOUT changing the decision:

```markdown
## Update Log

### 2025-12-01
Note: Performance exceeded expectations, response time < 1s in production.

### 2026-01-15
Note: Team completed training on this technology.
```

This does NOT violate immutability - you're adding context, not changing the decision.

---

## Cross-References

### From ADR to Other Docs
- Requirements: `[REQ-NF-XXX](../../business/requirements/non-functional.md#req-nf-xxx)`
- Other ADRs: `[ADR-YYYY](./YYYY-name.md)`
- Overview: `[Tech Stack](../overview.md)`

### To ADR from Other Docs
- Requirements should link to ADRs that address them
- Overview should reference key ADRs
- Decision log should list all ADRs

---

## Common Mistakes to Avoid

❌ **Editing accepted ADRs** → Create new ADR instead
❌ **Deleting old ADRs** → Mark as superseded, keep for history
❌ **Vague decisions** → Be specific and actionable
❌ **Missing consequences** → Always include trade-offs
❌ **No requirement links** → Connect to business needs
❌ **Too granular** → ADRs are for significant decisions only

---

## Checklist for New ADR

Before setting Status to "Accepted":
- [ ] Context clearly explains the problem
- [ ] Decision is specific and actionable
- [ ] Consequences include both positive AND negative
- [ ] Linked to driving requirements
- [ ] Alternatives considered (optional but recommended)
- [ ] File named correctly: `NNNN-description.md`
- [ ] Sequential number is correct
- [ ] Overview.md updated if needed
- [ ] Decision log updated
